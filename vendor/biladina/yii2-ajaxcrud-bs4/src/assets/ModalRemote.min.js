function ModalRemote(t){let e;function o(t){t&&t.readyState<4&&(t.onreadystatechange=$.noop,t.abort())}this.defaults={okLabel:"OK",executeLabel:"Execute",cancelLabel:"Cancel",loadingTitle:"Loading"},this.modal=$(t),this.dialog=$(t).find(".modal-dialog"),this.header=$(t).find(".modal-header"),this.content=$(t).find(".modal-body"),this.footer=$(t).find(".modal-footer"),this.loadingContent='<div class="progress"><div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%"></div></div>',$(this.modal).on("hidden.bs.modal",function(t){o(e)}),this.show=function(){this.clear(),$(this.modal).modal("show")},this.hide=function(){$(this.modal).modal("hide")},this.toggle=function(){$(this.modal).modal("toggle")},this.clear=function(){$(this.modal).find(".modal-title").remove(),$(this.content).html(""),$(this.footer).html("")},this.setSize=function(t){$(this.dialog).removeClass("modal-lg"),$(this.dialog).removeClass("modal-sm"),"large"==t?$(this.dialog).addClass("modal-lg"):"small"==t?$(this.dialog).addClass("modal-sm"):"normal"!==t&&console.warn("Undefined size "+t)},this.setHeader=function(t){$(this.header).html(t)},this.setContent=function(t){$(this.content).html(t)},this.setFocusOnInput=function(){const t=$(this.content);let e;const o=t.find("input[autofocus], textarea[autofocus]");if(o.length>0)e=o.last()[0];else{t.find("input, textarea").length>0&&(e=o.first()[0])}if(e&&document.activeElement!==e){try{document.activeElement.blur()}catch(t){console.log(t)}const t=50,o=40;let i=-1;!function a(){i++,document.activeElement===e||i>=o||(e.focus(),setTimeout(a,t))}()}},this.setFooter=function(t){$(this.footer).html(t)},this.setTitle=function(t){$(this.header).find("h4.modal-title").remove(),$(this.header).prepend('<h4 class="modal-title">'+t+"</h4>")},this.hidenCloseButton=function(){$(this.header).find("button.close").hide()},this.showCloseButton=function(){$(this.header).find("button.close").show()},this.displayLoading=function(){this.setContent(this.loadingContent),this.setTitle(this.defaults.loadingTitle)},this.addFooterButton=function(t,e,o,i){buttonElm=document.createElement("button"),buttonElm.setAttribute("type",null===e?"button":e),buttonElm.setAttribute("class",null===o?"btn btn-primary":o),buttonElm.innerHTML=t;var a=this;$(this.footer).append(buttonElm),null!==i&&$(buttonElm).click(function(t){i.call(a,this,t)})},this.doRemote=function(t,i,a){var n=this;o(e),e=$.ajax({url:t,method:i,data:a,beforeSend:function(){(function(){this.show(),this.displayLoading()}).call(n)},error:function(t){(function(t){this.setTitle(t.status+t.statusText),this.setContent(t.responseText),this.addFooterButton("Close","button","btn btn-default",function(t,e){this.hide()})}).call(n,t)},success:function(t){(function(t){if(void 0!==t.forceReload&&t.forceReload)if("true"==t.forceReload)$.pjax.reload({container:"#crud-datatable-pjax"});else if(t.forceReload.indexOf(",")>-1){var e=t.forceReload.split(",");$.each(e,function(t,e){$.pjax.reload({container:e}),$.pjax.xhr=null})}else $.pjax.reload({container:t.forceReload});if(void 0!==t.forceClose&&t.forceClose)return void this.hide();void 0!==t.size&&this.setSize(t.size);void 0!==t.title&&this.setTitle(t.title);void 0!==t.content&&(this.setContent(t.content),this.setFocusOnInput());void 0!==t.footer&&this.setFooter(t.footer);void 0!==$(this.content).find("form")[0]&&this.setupFormSubmit($(this.content).find("form")[0],$(this.footer).find('[type="submit"]')[0])}).call(n,t)},contentType:!1,cache:!1,processData:!1})},this.setupFormSubmit=function(t,e){if(void 0===e)console.warn("Modal has form but does not have a submit button");else{var o=this;$(e).click(function(e){var i;i=window.FormData?new FormData($(t)[0]):$(t).serializeArray(),o.doRemote($(t).attr("action"),$(t).hasAttr("method")?$(t).attr("method"):"GET",i)})}},this.confirmModal=function(t,e,o,i,a,n,s,d){this.show(),this.setSize(a),void 0!==t&&this.setTitle(t),this.setContent('<form id="ModalRemoteConfirmForm">'+e);var r=this;!1!==o&&this.addFooterButton(void 0===o?this.defaults.okLabel:o,"submit","btn btn-primary",function(t){var e;window.FormData?(e=new FormData($("#ModalRemoteConfirmForm")[0]),void 0!==d&&d&&e.append("pks",d.join())):(e=$("#ModalRemoteConfirmForm"),void 0!==d&&d&&(e.pks=d),e=e.serializeArray()),r.doRemote(n,s,e)}),this.addFooterButton(void 0===i?this.defaults.cancelLabel:i,"button","btn btn-default pull-left",function(t){this.hide()})},this.open=function(t,e){$(t).hasAttr("data-confirm-title")||$(t).hasAttr("data-confirm-message")?this.confirmModal($(t).attr("data-confirm-title"),$(t).attr("data-confirm-message"),!$(t).attr("data-confirm-alert")&&$(t).attr("data-confirm-ok"),$(t).attr("data-confirm-cancel"),$(t).hasAttr("data-modal-size")?$(t).attr("data-modal-size"):"normal",$(t).hasAttr("href")?$(t).attr("href"):$(t).attr("data-url"),$(t).hasAttr("data-request-method")?$(t).attr("data-request-method"):"GET",e):this.doRemote($(t).hasAttr("href")?$(t).attr("href"):$(t).attr("data-url"),$(t).hasAttr("data-request-method")?$(t).attr("data-request-method"):"GET",e)}}jQuery.fn.hasAttr=function(t){return void 0!==this.attr(t)};
